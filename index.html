<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="initial-scale=1,width=device-width" />
  <title>Mappa</title>
  <link rel="stylesheet" href="css/leaflet.css" />
  <style>
    html, body, #map { height: 100%; margin: 0; padding: 0; }
  </style>
</head>
<body>
  <div id="map"></div>

  <script src="js/leaflet.js"></script>
  <!-- I tuoi vettori -->
  <script src="data/Insediamenti_1.js"></script>

  <script>
    // Mappa
    const map = L.map('map', { minZoom: 0, maxZoom: 18 }).setView([45.8, 9.08], 10);

    // Raster tiles: PNG 512px, nativi fino a z=16
    const tiles = L.tileLayer('./tiles_raster/{z}/{x}/{y}.png', {
      attribution: '© raster',
      minZoom: 0,
      maxZoom: 18,       // puoi spingere un filo oltre (overzoom)
      maxNativeZoom: 16, // ⬅️ ULTIMO livello che hai generato davvero
      tileSize: 512,     // ⬅️ perché hai esportato 512px
      tms: false,        // se vedi “capovolto” o sparizioni, prova true
      noWrap: true
    }).addTo(map);

    // (Debug) log tile mancanti
    tiles.on('tileerror', e => console.log('TILE 404:', e.tile.src));

    // Layer punti (popup semplice)
    const punti = L.geoJson(json_Insediamenti_1, {
      onEachFeature: (f, layer) => {
        const p = f.properties || {};
        layer.bindPopup(
          `<table>
            <tr><th>Nome</th><td>${p.Nome || ''}</td></tr>
            <tr><th>Tipo</th><td>${p.Tipo || ''}</td></tr>
            <tr><th>Descrizione</th><td>${p.Descrizione || ''}</td></tr>
            <tr><th>Livello</th><td>${p.Livello || ''}</td></tr>
            <tr><th>Regione</th><td>${p.Regione || ''}</td></tr>
          </table>`
        );
      },
      pointToLayer: (f, latlng) => L.circleMarker(latlng, {
        radius: 4, color: '#232323', weight: 1,
        fillColor: '#bed04f', fillOpacity: 1
      })
    }).addTo(map);

    // Centra sui punti se presenti
    try {
      const b = punti.getBounds();
      if (b && b.isValid()) map.fitBounds(b);
    } catch(e) {}
  </script>
</body>
</html>
